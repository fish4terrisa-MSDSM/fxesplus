/*

____This_should_be_viewed_at_tabsize_at_least_8____

nul	mp	mn	me	mmu	a0	hconst	muN	muB	redH	alfa	re	lamc	gammap	lamcp	lamcn
Sx2	Sx	n	Sy2	Sy	Sxy	Sx3	Sx2y	Sx4	minX	maxX	minY	maxY	Rinf	u	mup
space	box	mue	mun	mumu	%	Fconst	econst	(	)	Na	+	,	-	decpt	@2f
0	1	2	3	4	5	6	7	8	9	:	k	<	=	>	@3f
Vm	A	B	C	D	E	Fvar	>A	>B	>C	>D	>M	>X	>Y	*	/
hhex	d	o	b	M	>a+bi	>rL8	!	X	Y	@5a	[	sqrdeg	]	^	/R
(-)	Not	Neg	Abs	x^1	x^	y^	x^2	log	Sum	Int	d/dx	Pol	Rec	and	or
sinh	cosh	tanh	e^	x10	^2	^3	^-1	R	c0	c1	{	@7c	}	xor	xnor
i	eulerE	pi	>E	>F	deg	rad	gra	Conjg	avgx	avgy	Ans	Ran#	@8d	@8e	@8f
sinh-1	cosh-1	tanh-1	10^	<=	!=	>=	@97	sqrt	M+	stata	statb	statc	r	cendot	xrt
sin	cos	tan	ln	@a4	>Conv	@a6	@a7	cbrt	M-	ox	sx	oy	sy	frac	L
sin-1	cos-1	tan-1	Rnd	c2	o'	eps0	mu0	hexA	hexB	hexC	hexD	hexE	hexF	Permu	Combi
det	Trn	Ranint#	arg	phi0	g	G0	Z0	MatA	MatB	MatC	MatAns	VctA	VctB	VctC	VctAns
P(	Q(	R(	>t	t	G	atm	in>cm	cm>in	ft>m	m>ft	yd>m	m>yd	mile>km	km>mile	nmile>m
m>nmile	acre>m2	m2>acre	galus>l	l>galus	galuk>l	l>galuk	pc>km	km>pc	kmh>ms	ms>kmh	oz>g	g>oz	lb>kg	kg>lb	atm>Pa
pa>atm	mmhg>pa	pa>mmhg	hp>kw	kw>hp	kgfcm2>	pa>kgf	kgfm>j	j>kgfm	lbfin2>	kpa>lbf	of>oc	oc>of	j>cal	cal>j	@ff

# Readable version

nul     mp      mn      me      mmu     a0      hconst  muN     muB     redH    alfa    re      lamc    gammap  lamcp   lamcn
Sx2     Sx      n       Sy2     Sy      Sxy     Sx3     Sx2y    Sx4     minX    maxX    minY    maxY    Rinf    u       mup
space   box     mue     mun     mumu    %       Fconst  econst  (       )       Na      +       ,       -       decpt   @2f
0       1       2       3       4       5       6       7       8       9       :       k       <       =       >       @3f
Vm      A       B       C       D       E       Fvar    >A      >B      >C      >D      >M      >X      >Y      *       /
hhex    d       o       b       M       >a+bi   >rL8    !       X       Y       @5a     [       sqrdeg  ]       ^       /R
(-)     Not     Neg     Abs     x^1     x^      y^      x^2     log     Sum     Int     d/dx    Pol     Rec     and     or
sinh    cosh    tanh    e^      x10     ^2      ^3      ^-1     R       c0      c1      {       @7c     }       xor     xnor
i       eulerE  pi      >E      >F      deg     rad     gra     Conjg   avgx    avgy    Ans     Ran#    @8d     @8e     @8f
sinh-1  cosh-1  tanh-1  10^     <=      !=      >=      @97     sqrt    M+      stata   statb   statc   r       cendot  xrt
sin     cos     tan     ln      @a4     >Conv   @a6     @a7     cbrt    M-      ox      sx      oy      sy      frac    L
sin-1   cos-1   tan-1   Rnd     c2      o'      eps0    mu0     hexA    hexB    hexC    hexD    hexE    hexF    Permu   Combi
det     Trn     Ranint# arg     phi0    g       G0      Z0      MatA    MatB    MatC    MatAns  VctA    VctB    VctC    VctAns
P(      Q(      R(      >t      t       G       atm     in>cm   cm>in   ft>m    m>ft    yd>m    m>yd    mile>km km>mile nmile>m
m>nmile acre>m2 m2>acre galus>l l>galus galuk>l l>galuk pc>km   km>pc   kmh>ms  ms>kmh  oz>g    g>oz    lb>kg   kg>lb   atm>Pa
pa>atm  mmhg>pa pa>mmhg hp>kw   kw>hp   kgfcm2> pa>kgf  kgfm>j  j>kgfm  lbfin2> kpa>lbf of>oc   oc>of   j>cal   cal>j   @ff

# NPRESSES

999	4	4	4	4	4	4	4	4	4	4	4	4	4	4	4	
100	100	100	100	100	100	100	100	100	100	100	100	100	4	4	4	
100	100	4	4	4	2	4	4	1	1	4	1	1	1	1	100	
1	1	1	1	1	1	1	1	1	1	2	4	100	2	100	100	
4	2	2	2	2	2	2	100	100	100	100	100	100	100	1	1	
100	100	100	100	2	100	100	2	2	2	100	100	1	100	1	100	
1	100	100	2	100	100	100	100	1	2	1	2	2	2	100	100	
2	2	2	2	1	1	2	1	4	4	4	100	100	100	100	100	
100	2	2	100	100	3	3	3	100	100	100	1	2	100	100	100	
2	2	2	2	100	100	100	100	1	100	100	100	100	100	100	2	
1	1	1	1	100	100	100	100	2	100	100	100	100	100	1	100	
2	2	2	2	4	4	4	4	100	100	100	100	100	100	2	2	
100	100	2	100	4	4	4	4	100	100	100	100	100	100	100	100	
100	100	100	100	4	4	4	4	4	4	4	4	4	4	4	4	
4	4	4	4	4	4	4	4	4	4	4	4	4	4	4	4	
4	4	4	4	4	4	4	4	4	4	4	4	4	4	4	100	


# CONST
mp	mn	me	mmu	a0	hconst	muN	muB	redH	alfa	re	lamc	gammap	lamcp	lamcn
Rinf	u	mup
mue	mun	mumu	Fconst	econst	Na
k
Vm
R	c0	c1	
c2	o'	eps0	mu0
phi0	g	G0	Z0
t	G	atm

# CONV
in>cm	cm>in	ft>m	m>ft	yd>m	m>yd	mile>km	km>mile	nmile>m
m>nmile	acre>m2	m2>acre	galus>l	l>galus	galuk>l	l>galuk	pc>km	km>pc	kmh>ms	ms>kmh	oz>g	g>oz	lb>kg	kg>lb	atm>Pa
pa>atm	mmhg>pa	pa>mmhg	hp>kw	kw>hp	kgfcm2>	pa>kgf	kgfm>j	j>kgfm	lbfin2>	kpa>lbf	of>oc	oc>of	j>cal	cal>j


0 tanh-1 @ tanh nul ? ? ? ? ? ? ? Sx2 mn Sx tanh-1 F pa>atm nul ? econst mn cos sin Vm pa>atm mun MatA @ n of>oc MatA mmu nul ? ? ? sinh-1
pa>mmhg i mp m>nmile mp pa>atm ms>kmh >A nul ? ? ? ? pa>mmhg lamcn cal>j mp VctC @ VctC mp alfa lamc pa>atm Sx3 o' L sinh-1 o sinh-1 @
sinh mn MatA @ cosh space MatB L sinh-1 o tanh-1 L sinh-1 o <= L sinh-1 h >= L sinh-1 h @ i l>galus pa>atm MatB mp tan re MatA mp @ redH
MatA or sinh-1 mn sqrt pi m>nmile xnor sinh-1 mun sqrt pi m2>acre cal>j l>galus j>kgfm MatA galus>l VctC or sinh-1 nul ? eulerE m>nmile 
xnor sinh-1 box sqrt eulerE m2>acre @ l>galus j>kgfm MatA m>ft VctC mp pa>atm h nul ? ? ? ? ? ? ? ? ? @ VctC j>kgfm and kw>hp xor j>kgfm 
B Vm muB pa>atm redH mp mn Sx

# MAP (may not be uptodate)

re--	im--	diff

276a	28fc	192

27fa	298c	192
3485	3617	192

3518	3624	10C
479c	48a8	10c
47ea	48f6	10c

4922	4A30	10E
4c34	4d42	10E

4e54	5596	742
7777	7eb9	742

7fc2	88e6	924
AFB2	B8D6	924
B148	BA6C	924

B292	Bb40	8ae
b3b2	bc60	8AE

b642	bf68	926
b660	bf86	926

C702	D4C4	DC2

154ee	154ee	0
16052	16052	0
168b0	168b0	0



javascript code:

*/














consts=`
mp	mn	me	mmu	a0	hconst	muN	muB	redH	alfa	re	lamc	gammap	lamcp	lamcn
Rinf	u	mup
mue	mun	mumu	Fconst	econst	Na
k
Vm
R	c0	c1	
c2	o'	eps0	mu0
phi0	g	G0	Z0
t	G	atm
`.split(/\s/).filter(x=>x!=="");

convs=`
in>cm	cm>in	ft>m	m>ft	yd>m	m>yd	mile>km	km>mile	nmile>m
m>nmile	acre>m2	m2>acre	galus>l	l>galus	galuk>l	l>galuk	pc>km	km>pc	kmh>ms	ms>kmh	oz>g	g>oz	lb>kg	kg>lb	atm>Pa
pa>atm	mmhg>pa	pa>mmhg	hp>kw	kw>hp	kgfcm2>	pa>kgf	kgfm>j	j>kgfm	lbfin2>	kpa>lbf	of>oc	oc>of	j>cal	cal>j
`.split(/\s/).filter(x=>x!=="");

names=`
nul	mp	mn	me	mmu	a0	hconst	muN	muB	redH	alfa	re	lamc	gammap	lamcp	lamcn
Sx2	Sx	n	Sy2	Sy	Sxy	Sx3	Sx2y	Sx4	minX	maxX	minY	maxY	Rinf	u	mup
space	box	mue	mun	mumu	%	Fconst	econst	(	)	Na	+	,	-	decpt	@2f
0	1	2	3	4	5	6	7	8	9	:	k	<	=	>	@3f
Vm	A	B	C	D	E	Fvar	>A	>B	>C	>D	>M	>X	>Y	*	/
hhex	d	o	b	M	>a+bi	>rL8	!	X	Y	@5a	[	sqrdeg	]	^	/R
(-)	Not	Neg	Abs	x^1	x^	y^	x^2	log	Sum	Int	d/dx	Pol	Rec	and	or
sinh	cosh	tanh	e^	x10	^2	^3	^-1	R	c0	c1	{	@7c	}	xor	xnor
i	eulerE	pi	>E	>F	deg	rad	gra	Conjg	avgx	avgy	Ans	Ran#	@8d	@8e	@8f
sinh-1	cosh-1	tanh-1	10^	<=	!=	>=	@97	sqrt	M+	stata	statb	statc	r	cendot	xrt
sin	cos	tan	ln	@a4	>Conv	@a6	@a7	cbrt	M-	ox	sx	oy	sy	frac	L
sin-1	cos-1	tan-1	Rnd	c2	o'	eps0	mu0	hexA	hexB	hexC	hexD	hexE	hexF	Permu	Combi
det	Trn	Ranint#	arg	phi0	g	G0	Z0	MatA	MatB	MatC	MatAns	VctA	VctB	VctC	VctAns
P(	Q(	R(	>t	t	G	atm	in>cm	cm>in	ft>m	m>ft	yd>m	m>yd	mile>km	km>mile	nmile>m
m>nmile	acre>m2	m2>acre	galus>l	l>galus	galuk>l	l>galuk	pc>km	km>pc	kmh>ms	ms>kmh	oz>g	g>oz	lb>kg	kg>lb	atm>Pa
pa>atm	mmhg>pa	pa>mmhg	hp>kw	kw>hp	kgfcm2>	pa>kgf	kgfm>j	j>kgfm	lbfin2>	kpa>lbf	of>oc	oc>of	j>cal	cal>j	@ff
`.split(/\s/).filter(x=>x!=="").map(x=>{
    let i = consts.indexOf(x);
    if (~i) x = "cs" + (i+1);
    i = convs.indexOf(x);
    if (~i) x = "cv" + (i+1);
    return x;
});

npress=`
999	4	4	4	4	4	4	4	4	4	4	4	4	4	4	4	
100	100	100	100	100	100	100	100	100	100	100	100	100	4	4	4	
100	100	4	4	4	2	4	4	1	1	4	1	1	1	1	100	
1	1	1	1	1	1	1	1	1	1	2	4	100	2	100	100	
4	2	2	2	2	2	2	100	100	100	100	100	100	100	1	1	
100	100	100	100	2	100	100	2	2	2	100	100	1	100	1	100	
1	100	100	2	100	100	100	100	1	2	1	2	2	2	100	100	
2	2	2	2	1	1	2	1	4	4	4	100	100	100	100	100	
100	2	2	100	100	3	3	3	100	100	100	1	2	100	100	100	
2	2	2	2	100	100	100	100	1	100	100	100	100	100	100	2	
1	1	1	1	100	100	100	100	2	100	100	100	100	100	1	100	
2	2	2	2	4	4	4	4	100	100	100	100	100	100	2	2	
100	100	2	100	4	4	4	4	100	100	100	100	100	100	100	100	
100	100	100	100	4	4	4	4	4	4	4	4	4	4	4	4	
4	4	4	4	4	4	4	4	4	4	4	4	4	4	4	4	
4	4	4	4	4	4	4	4	4	4	4	4	4	4	4	100	
`.split(/\s/).filter(x=>x!=="").map(x=>Number.parseInt(x,10));

keys1 = y => names[Number.parseInt(y, 16)]
keys2 = y => keys1(y.slice(0,2)) + ' ' + keys1(y.slice(2))
keys_ = y => y.match(/../g).map(keys1).join(' ')

nkey1 = y => npress[Number.parseInt(y, 16)]
nkey2 = y => nkey1(y.slice(0,2))+nkey1(y.slice(2))
nkey_ = y => sum(y.match(/../g).map(nkeys1))

minkfpc = x => {
    x = Number.parseInt(x, 16) & 0x1FFFE;
    return nkey2(x.toString(16)) <= nkey2((x+1).toString(16)) ? keys2(x.toString(16)) : keys2((x+1).toString(16));
}

mapri=`
276a	28fc	192

27fa	298c	192
3485	3617	192

3518	3624	10C
479c	48a8	10c
47ea	48f6	10c

4922	4A30	10E
4c34	4d42	10E

4e54	5596	742
7777	7eb9	742

7fc2	88e6	924
AFB2	B8D6	924
B148	BA6C	924

B292	Bb40	8ae
b3b2	bc60	8AE

b642	bf68	926
b660	bf86	926

C702	D4C4	DC2

154ee	154ee	0
16052	16052	0
168b0	168b0	0
`.split(/\s/).filter(x=>x!=="")
.map(x=>Number.parseInt(x,16))

/*convri = x=>{
    x = Number.parseInt(x, 16);
    for (let i = 3; i < mapri.length; i += 3) {
        if (mapri[i-3+2] === mapri[i+2] && mapri[i-3] <= x && x <= mapri[i]) return (x + mapri[i+2]).toString(16);
    }
    return "";
}

convir = x=>{
    x = Number.parseInt(x, 16);
    for (let i = 3; i < mapri.length; i += 3) {
        if (mapri[i-3+2] === mapri[i+2] && mapri[i-2] <= x && x <= mapri[i+1]) return (x - mapri[i+2]).toString(16);
    }
    return "";
}*/

values_ = y => y.split(/\s/).map(x=>(0+names.indexOf(x).toString(16)).slice(-2));

roundkf = (x,cond)=>{
	if ("undefined" === typeof cond) cond = yi=>nkey2(yi.toString(16))<100;
	if ("number" === typeof x) x = [x];
	for(i=327; i<363; ++i) (y=>{
		if (y.every(cond))
			console.log(i + ":" + y.map(x=>x.toString(16)) + "->" + y.map(x=>keys2(x.toString(16))));
	})(
		x.map(xi=>(i*100+xi+8))
	)
}

minby=(xs,f)=>{
    var Ox=xs[0];var Of=f(Ox);
    for(var x of xs){
        var f1=f(x);if(f1<Of){Of=f1;Ox=x;}
    }return Ox;
}

sum=xs=>xs.reduce((a,b)=>a+b)

rel = x => (x === ' ' ? [0x20, 0x0e] : [x.toLowerCase().charCodeAt(0), x.toUpperCase().charCodeAt(0)])
bestrel = x=>npress[x.charCodeAt(0)]<20?x.charCodeAt(0):minby(rel(x),i=>npress[i])

best = st=>st.split('').map(bestrel)

x=>values_(minkfpc(x)).map(a=>npress[Number.parseInt(a,16)]).reduce((a,b)=>a+b)

nminkfpc = x=>sum(values_(minkfpc(x)).map(nkey1))

help = _=>`
values_('1 2 3') = ['31','32','33']
keys1('31') = '1'
keys2('3132') = '1 2' // inverse of values_
keys_('313233') = '1 2 3'

nkey1('31') = 1
nkey2('3132') = 2
nkey_('313233') = 3

minkfpc('12345') = keys2(something) that gives min nkey2
nminkfpc('12345') = 10 // or something
roundkf([1,2,3]) prints optimal positions

minby(xs,f)
sum(xs)
`

console.clear();


